import React, { useEffect, useState } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import styles from '../styles/PackagePage.module.css';
import API, { endpoints } from '../configs/API';
import { useNotification } from '../utils/toast';

const Package = () => {
    const { id } = useParams();
    const [pkg, setPkg] = useState(null);
    const [loading, setLoading] = useState(true);
    const sendNotification = useNotification();
    const navigate = useNavigate();

    useEffect(() => {
        const fetchPackage = async () => {
            try {
                const res = await API.get(`${endpoints.packages}/${id}`);
                setPkg(res.data);
            } catch (err) {
                sendNotification({ message: "L·ªói khi t·∫£i chi ti·∫øt g√≥i t·∫≠p" }, 'error');
            } finally {
                setLoading(false);
            }
        };

        fetchPackage();
    }, [id, sendNotification]);

    if (loading) return <div className={styles.loading}>ƒêang t·∫£i...</div>;
    if (!pkg) return <div className={styles.error}>Kh√¥ng t√¨m th·∫•y g√≥i t·∫≠p</div>;

    const handleRegister = () => navigate(`/packages/${pkg.id}/confirm`);

    return (
        <div className={styles.container}>
            <h1 className={styles.title}>{pkg.name}</h1>
            <div className={styles.card}>
                <div className={styles.code}>
                    <p>{pkg.code}</p>
                </div>

                <div className={styles.section}>
                    <h3>Chi ti·∫øt g√≥i t·∫≠p</h3>
                    <ul>
                        <li><strong>Th·ªùi gian:</strong> {pkg.duration}</li>
                        <li><strong>S·ªë bu·ªïi PT:</strong> {pkg.ptSessions}</li>
                        <li><strong>Gi√°:</strong> {Number(pkg.price).toLocaleString('vi-VN')} VNƒê</li>
                    </ul>
                </div>

                <div className={styles.section}>
                    <h3>M√¥ t·∫£</h3>
                    <p>{pkg.description}</p>
                </div>

                <div className={styles.actions}>
                    <button className={`${styles.button}`}
                        onClick={() => navigate("/packages")}>‚Üê Quay l·∫°i</button>
                    <button className={`${styles.button} ${styles.subscribe}`}
                        onClick={handleRegister}>üìù ƒêƒÉng k√Ω</button>
                </div>
            </div>
        </div>
    );
};

export default Package;
