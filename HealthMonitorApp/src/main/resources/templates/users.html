<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Qu·∫£n l√Ω Th√†nh vi√™n | Gym Health Monitor</title>
        <link rel="icon" th:href="@{/images/logo.png}" />
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

    <th:block th:replace="base :: bootstrap"></th:block>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <div th:replace="base :: header"></div>

    <main class="container mt-4">
        <h2 class="text-center w-100 mb-3">üìã Danh s√°ch Th√†nh vi√™n</h2>

        <div class="d-flex justify-content-between align-items-center mb-1">
            <div>
                <a th:href="@{/users/add}" class="btn btn-success me-1">‚ûï Th√™m</a>

                <!-- X√≥a nhi·ªÅu th√†nh vi√™n -->
                <button type="submit" id="deleteButton" class="btn btn-danger" 
                        onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a c√°c th√†nh vi√™n ƒë√£ ch·ªçn?');" disabled>
                    üóëÔ∏è X√≥a
                </button>
            </div>

            <!-- Thanh t√¨m ki·∫øm -->
            <form th:action="@{/users}" method="get" class="mb-3 d-flex">
                <input type="text" name="kw" th:value="${kw}" class="form-control me-2 w-auto" placeholder="üîç T√¨m ki·∫øm...">
                <button type="submit" class="btn btn-primary w-auto">T√¨m ki·∫øm</button>
            </form>
        </div>

        <form th:action="@{/users/delete}" method="post">
            <div class="table-responsive">
                <table class="table table-hover table-bordered text-center">
                    <thead class="table-dark">
                        <tr>
                            <th><input type="checkbox" id="selectAll" onclick="toggleSelectAll()"></th>
                            <th>T√™n t√†i kho·∫£n</th>
                            <th>H·ªç</th>
                            <th>T√™n</th>
                            <th>Email</th>
                            <th>S·ªë ƒëi·ªán tho·∫°i</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="user : ${users}">
                            <td>
                                <input type="checkbox" name="selectedUsers" value="${user.id}">
                            </td>
                            <td>
                                <a th:href="@{/users/edit/{id}(id=${user.id})}" th:text="${user.username}"></a>
                            </td>
                            <td th:text="${user.firstName}"></td>
                            <td th:text="${user.lastName}"></td>
                            <td th:text="${user.email}"></td>
                            <td th:text="${user.phone}"></td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(users)}">
                            <td colspan="6">Kh√¥ng c√≥ th√†nh vi√™n n√†o.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </form>
        <div class="text-end fw-bold mb-1">
            T·ªïng s·ªë th√†nh vi√™n: <span th:text="${totalUsers}"></span>
        </div>

        <!-- Pagination -->
        <nav aria-label="Page navigation" th:if="${totalPages > 1}">
            <ul class="pagination justify-content-center">
                <!-- Trang ƒë·∫ßu -->
                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                    <a class="page-link" th:href="@{/users(page=1, keyword=${keyword})}" tabindex="-1">‚èÆÔ∏è ƒê·∫ßu</a>
                </li>

                <!-- Trang tr∆∞·ªõc -->
                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                    <a class="page-link" th:href="@{/users(page=${currentPage - 1}, keyword=${keyword})}" tabindex="-1">‚¨ÖÔ∏è Tr∆∞·ªõc</a>
                </li>

                <!-- Hi·ªÉn th·ªã t·ªëi ƒëa 5 s·ªë trang -->
                <th:block th:with="start=${currentPage - 2 > 1 ? currentPage - 2 : 1}, 
                          end=${currentPage + 2 < totalPages ? currentPage + 2 : totalPages}">
                    <li class="page-item" th:each="i : ${#numbers.sequence(start, end)}"
                        th:classappend="${i == currentPage} ? 'active'">
                        <a class="page-link" th:href="@{/users(page=${i}, keyword=${keyword})}" th:text="${i}"></a>
                    </li>
                </th:block>

                <!-- Trang sau -->
                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                    <a class="page-link" th:href="@{/users(page=${currentPage + 1}, keyword=${keyword})}">Ti·∫øp ‚û°Ô∏è</a>
                </li>

                <!-- Trang cu·ªëi -->
                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                    <a class="page-link" th:href="@{/users(page=${totalPages}, keyword=${keyword})}">Cu·ªëi ‚è≠Ô∏è</a>
                </li>
            </ul>
        </nav>
    </main>

    <div th:replace="base :: footer"></div>

    <script>
        // Toggle select/unselect all checkboxes
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById("selectAll");
            const checkboxes = document.querySelectorAll("input[name='selectedUsers']");
            checkboxes.forEach((checkbox) => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            checkSelectedUsers();
        }

        // Enable or disable delete button based on selected checkboxes
        function checkSelectedUsers() {
            const selectedUsers = document.querySelectorAll("input[name='selectedUsers']:checked");
            const deleteButton = document.getElementById("deleteButton");

            // Enable delete button if at least one checkbox is selected
            if (selectedUsers.length > 0) {
                deleteButton.disabled = false;
            } else {
                deleteButton.disabled = true;
            }
        }
    </script>
</body>
</html>
